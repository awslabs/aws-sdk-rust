on:
  workflow_dispatch:
  pull_request:
  schedule:
    # Run at the top of the hour, every hour
    - cron:  '0 * * * *'

name: Sync with smithy-rs commits

env:
  rust_version: 1.54.0
  rust_toolchain_components: clippy,rustfmt
  java_version: 11

jobs:
  repo-lint:
    name: run sync tool
    runs-on: ubuntu-latest
    steps:
    - name: checkout aws-sdk-rust
      uses: actions/checkout@v2
      with:
        ref: next
        path: aws-sdk-rust
        fetch-depth: 0
    - name: checkout smithy-rs
      uses: actions/checkout@v2
      with:
        repository: awslabs/smithy-rs
        ref: main
        path: smithy-rs
        fetch-depth: 0
    - uses: actions-rs/toolchain@v1
      with:
        toolchain: ${{ env.rust_version }}
        components: ${{ env.rust_toolchain_components }}
        default: true
    - uses: actions/setup-java@v1
      with:
        java-version: ${{ env.java_version }}
    - name: build sync tool
      run: cargo build --release
      working-directory: smithy-rs/tools/smithy-rs-sync
    - name: run sync tool
      run: |
        smithy-rs/target/release/smithy-rs-sync \
          --smithy-rs smithy-rs \
          --aws-sdk aws-sdk-rust
    - name: push commits
      run: git push
      working-directory: aws-sdk-rust
